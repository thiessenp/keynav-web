<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>Keynav Tests</title>
</head>
<body>

    <h1>Keynav Tests</h1>

    <section aria-labelledby="hotkeytest-label">
        <h1 id="hotkeytest-label">Hotkey Test</h1>
        <button id="xtest" data-knw-hotkey="x">Hotkey <key>x</key> triggered me</button>
        <button id="ctrlxtest" data-knw-hotkey="ctrl+x">Hotkey <key>ctrl+x</key> triggered me</button>
    </section>

    <section aria-labelledby="keynavtest-label">
        <h1 id="keynavtest-label">Keynav Tests</h1>
        <div>
            <h2 id="keynavUpDown-label">List of Items 1 - nav with up or down keys</h2>
            <ul id="keynavUpDown-list1" aria-labelledby="keynavUpDown-label" data-knw-list>
                <li data-knw-list-item id="test1">List Item A</li>
                <li data-knw-list-item>List Item B</li>
                <li data-knw-list-item>List Item C</li>
                <li data-knw-list-item>List Item D</li>
            </ul>
            <output aria-label="List item activated" aria-live="polite" aria-relevant="additions" id="keynavUpDown-output"/>
        </div>
        <div>
            <h2 id="keynavUpDown2-label">List of Items 2 - check multiple lists work</h2>
            <ul id="keynavUpDown2-list" aria-labelledby="keynavUpDown2-label" data-knw-list>
                <li>Not In List</li>
                <li tabindex="-1" data-knw-list-item>List Item B</li>
                <li data-knw-list-item>List Item C (start missing tabindex)</li>
                <li tabindex="0" data-knw-list-item>List Item A (start tabindex=0")</li>
            </ul>
            <output aria-label="List item activated" aria-live="polite" aria-relevant="additions" id="keynavUpDown2-output"></output>
        </div>
    </section>

    <!-- 
        CORS... must load file on Server for modules (ES does XHR req for mods):
        <script type="module" src="../keynav-web.js"></script>
        <script type="module">
            import KeynavWeb from '../index.js';
            ...my code

        Would be a pain why below script ...
     -->
    <script src="../dist/index.js"></script>
    <script>
        console.log('KeynavWeb=', KeynavWeb);
        console.log('KeynavWeb.Hotkeys=', KeynavWeb.Hotkeys);
        console.log('KeynavWeb.Keynav=', KeynavWeb.Keynav);

        document.addEventListener('DOMContentLoaded', function() {
            // Add hotkeys (searched from DOM)
            KeynavWeb.Hotkeys.init();

            KeynavWeb.Keynav.init({
                // activateCb: function(item) {
                //     console.log('activateCb test, item=', item);
                //     if (!item) { return; }
                //     // Only update if el is not currently active, avoids DOM confusion
                //     if(item.getAttribute('tabindex') !== '0') {
                //         // // Remove any old state to make way for the New Active!
                //         // this.removeActive();
                //         item.setAttribute('tabindex', '0');
                //     }
                // },
                // deactivateCb: function(item) {
                //     console.log('deactivateCb test, item=', item);
                //     if (!item) { return; }
                //     if (item.getAttribute('tabindex') !== '-1') {
                //         item.setAttribute('tabindex', '-1');
                //     }
                // },
            });

            //
            // Add custom behavior to test Above hotkeys and keynav
            //
            
            // "Click" Handlers for Triggered Hotkeys
            xtest.addEventListener('click', function() {
                alert('x keyed and triggered me -or- i was clicked')
            });
            ctrlxtest.addEventListener('click', function() {
                alert('ctrl+x keyed and triggered me -or- i was clicked')
            });

            // Set some behavior for when a list element is activated
            const listEl = document.querySelector('#keynavUpDown-list1');
            const childrenElArr = Array.prototype.slice.call(listEl.children);
            const outputEl = document.querySelector('#keynavUpDown-output');
            childrenElArr.forEach(function(el) {
                el.addEventListener('focus', function(e) {
                    console.log('focus', e);
                });
                el.addEventListener('click', function(e) {
                    console.log('click', e.target.textContent);
                    updateOutput(outputEl, 'You activated ' + e.target.textContent);
                });
            });

            // Copied from above - abstract out if copy again :)
            const listEl2 = document.querySelector('#keynavUpDown2-list');
            const childrenElArr2 = Array.prototype.slice.call(listEl2.children);
            const outputEl2 = document.querySelector('#keynavUpDown2-output');
            childrenElArr2.forEach(function(el) {
                el.addEventListener('focus', function(e) {
                    console.log('focus', e);
                });
                el.addEventListener('click', function(e) {
                    console.log('click', e.target.textContent);
                    updateOutput(outputEl2, 'You activated ' + e.target.textContent);
                });
            });
        });

        function updateOutput(el, content) { 
            // innerHtml only updated DOM not text it seems?
            // el.innerHtml = content;
            el.textContent = content;
        }
    </script>
</body>
</html>